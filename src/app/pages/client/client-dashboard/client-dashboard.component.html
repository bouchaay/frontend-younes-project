<section class="client-dashboard">
  <div class="container">
    <h2>Bienvenue sur votre espace client</h2>

    <!-- üìÜ Bouton Prendre un RDV -->
    <div class="appointment-btn-wrapper">
      <button class="appointment-btn" (click)="openAppointmentModal()">Prendre un rendez-vous</button>
    </div>
    
    <!-- ‚úÖ Section 1 : Rendez-vous Confirm√©s -->
    <h3>‚úÖ Rendez-vous confirm√©s</h3>
    <div class="appointments-wrapper">
      <div class="appointments">
        @if (upcomingAppointments.length === 0) {
        <p class="no-appointment">Vous n'avez aucun rendez-vous confirm√©.</p>
        } @else {
        @for (appointment of upcomingAppointments; track appointment.id) {
        <div class="appointment-card" status="Confirm√©">
          <h4>{{ appointment.service }}</h4>
          <p><strong>Date :</strong> {{ appointment.date }}</p>
          <p><strong>Heure :</strong> {{ appointment.time }}</p>
          @if (appointment.employeeName && appointment.employeeName !== '') {
          <p><strong>Employ√© :</strong> {{ appointment.employeeName }}</p>
          }

          <!-- üî• Bouton Annuler d'urgence -->
          <button class="cancel-btn urgent" (click)="cancelAppointment(appointment.id)">Annuler d'urgence</button>
        </div>
        }
        }
      </div>
    </div>
    <p class="info-confirmation">
      ‚ÑπÔ∏è Les rendez-vous confirm√©s peuvent √™tre annul√©s au plus tard <strong>48 heures avant leur heure pr√©vue</strong>.
    </p>

    <!-- ‚è≥ Section 2 : Rendez-vous en attente -->
    <h3>‚è≥ Rendez-vous en attente</h3>
    <div class="appointments-wrapper">
      <div class="appointments">
        @if (pendingAppointments.length === 0) {
        <p class="no-appointment">Vous n'avez aucun rendez-vous en attente.</p>
        } @else {
        @for (appointment of pendingAppointments; track appointment.id) {
        <div class="appointment-card" status="En attente">
          <h4>{{ appointment.service }}</h4>
          <p><strong>Date :</strong> {{ appointment.date }}</p>
          <p><strong>Heure :</strong> {{ appointment.time }}</p>
          @if (appointment.employeeName && appointment.employeeName !== '') {
          <p><strong>Employ√© :</strong> {{ appointment.employeeName }}</p>
          }

          <!-- üî• Bouton Annuler un rendez-vous en attente -->
          <button class="cancel-btn" (click)="cancelAppointment(appointment.id)">Annuler</button>
        </div>
        }
        }
      </div>
    </div>

    <!-- üèÅ Section 3 : Rendez-vous Termin√©s -->
    <h3>üèÅ Rendez-vous termin√©s</h3>
    <div class="appointments-wrapper">
      <div class="appointments">
        @if (completedAppointments.length === 0) {
        <p class="no-appointment">Aucun rendez-vous termin√©.</p>
        } @else {
        @for (appointment of completedAppointments; track appointment.id) {
        <div class="appointment-card" status="Termin√©">
          <h4>{{ appointment.service }}</h4>
          <p><strong>Date :</strong> {{ appointment.date }}</p>
          <p><strong>Heure :</strong> {{ appointment.time }}</p>
          <p><strong>Employ√© :</strong> {{ appointment.employeeName }}</p>
        </div>
        }
        }
      </div>
    </div>

    <h3>‚ùå Rendez-vous annul√©s</h3>
    <div class="appointments-wrapper">
      <div class="appointments">
        @if (canceledAppointments.length === 0) {
        <p class="no-appointment">Aucun rendez-vous annul√©.</p>
        } @else {
        @for (appointment of canceledAppointments; track appointment.id) {
        <div class="appointment-card" status="Annul√©">
          <h4>{{ appointment.service }}</h4>
          <p><strong>Date :</strong> {{ appointment.date }}</p>
          <p><strong>Heure :</strong> {{ appointment.time }}</p>
          <p><strong>Employ√© :</strong> {{ appointment.employeeName }}</p>
        </div>
        }
        }
      </div>
    </div>

    <!-- üìÜ Bouton Prendre un RDV -->
    <div class="appointment-btn-wrapper">
      <button class="appointment-btn" (click)="openAppointmentModal()">Prendre un rendez-vous</button>
    </div>

    <!-- üìÜ Modale pour prendre un rendez-vous -->
    @if (showAppointmentModal) {
    <div class="modal-overlay">
      <div class="modal-content">
        <h3>Prendre un rendez-vous</h3>
        <form (ngSubmit)="bookAppointment()">
          <label>Service :</label>
          <select [(ngModel)]="selectedService" name="service" [compareWith]="compareServices" (change)="onServiceChange()"required>
            @for (service of availableServices; track service) {
            <option [ngValue]="service"> {{ service.label }} ‚Äî {{ formatDuration(service.duration) }} </option>
            }
          </select>

          <!--
          <label>Professionnel :</label>
          <select [(ngModel)]="newAppointment.employeeName" name="employeeName" required>
            @for (employee of employees; track employee.id) {
            <option [value]="employee.name">{{ employee.name }}</option>
            }
          </select>
        -->
          <label>Date :</label>
          <input type="date" [(ngModel)]="newAppointment.date" name="date" required (change)="onDateChange($event)"
            [min]="minDate" />

          <label>Heure :</label>
          <select [(ngModel)]="newAppointment.time" name="time" required>
            <option value="" disabled selected hidden>Choisissez une heure</option>
            @for (slot of timeSlots; track slot) {
            <option [value]="slot" [disabled]="unavailableSlots.includes(slot) || tooLateSlots.includes(slot)">
              {{ slot }} @if (unavailableSlots.includes(slot)) { (indisponible) } @else if (tooLateSlots.includes(slot)) { (trop tard) }
            </option>
            }
          </select>

          <div class="modal-actions">
            <button type="submit" class="save-btn">R√©server</button>
            <button type="button" class="cancel-btn" (click)="closeAppointmentModal()">Annuler</button>
          </div>
        </form>
      </div>
    </div>
    }
  </div>
</section>